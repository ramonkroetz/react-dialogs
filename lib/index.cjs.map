{"version":3,"sources":["../src/index.ts","../src/components/Dialog.tsx","../src/hooks/useDialog.ts","../src/contexts/DialogProvider.tsx"],"sourcesContent":["'use client'\n\nexport * from './components/Dialog'\nexport * from './contexts/DialogProvider'\nexport * from './hooks/useDialog'\n","import { AnimatePresence, motion, type Variants } from 'motion/react'\nimport { type PropsWithChildren, useRef } from 'react'\nimport { RemoveScroll } from 'react-remove-scroll'\nimport { useClickAway } from 'react-use'\n\nimport { useDialog } from '../hooks/useDialog'\n\ntype DialogProps = {\n  id: string\n  animation?: Variants | null\n  onClickAwayCallback?: () => void\n}\n\nconst DEFAULT_ANIMATION: Variants = {\n  initial: { opacity: 0, scale: 0.75 },\n  animate: {\n    opacity: 1,\n    scale: 1,\n  },\n  exit: {\n    opacity: 0,\n    scale: 0.75,\n  },\n}\n\nexport function Dialog({\n  id,\n  children,\n  animation = DEFAULT_ANIMATION,\n  onClickAwayCallback,\n}: PropsWithChildren<DialogProps>) {\n  const contentRef = useRef<HTMLDivElement>(null)\n  const { isOpen, close, isTopDialog } = useDialog(id)\n\n  useClickAway(contentRef, () => {\n    setTimeout(() => {\n      if (isOpen && isTopDialog) {\n        onClickAwayCallback?.()\n        close()\n      }\n    }, 0)\n  })\n\n  const animationProps = animation ?? {}\n\n  return (\n    <AnimatePresence>\n      {isOpen && (\n        <motion.dialog\n          {...animationProps}\n          className=\"react-dialog\"\n          onCancel={(e) => e.preventDefault()}\n          ref={(node: HTMLDialogElement) => {\n            if (node) {\n              node.showModal()\n            }\n          }}\n        >\n          <RemoveScroll className=\"react-dialog-content\" ref={contentRef}>\n            {children}\n          </RemoveScroll>\n        </motion.dialog>\n      )}\n    </AnimatePresence>\n  )\n}\n","'use-client'\n\nimport { useCallback, useContext } from 'react'\n\nimport { DialogContext } from '../contexts/DialogProvider'\n\nexport function useDialog<T>(id: string) {\n  const { modals, overlayOrder, show: showModal, close: closeModal, updateProps } = useContext(DialogContext)\n\n  const show = useCallback((showProps?: T) => showModal(id, showProps || {}), [showModal, id])\n  const close = useCallback(() => closeModal(id), [id, closeModal])\n  const updatePropsDialog = useCallback((newProps?: T) => updateProps(id, newProps || {}), [id, updateProps])\n\n  return {\n    show,\n    close,\n    updateProps: updatePropsDialog,\n    isOpen: modals[id]?.isOpen ?? false,\n    props: modals[id]?.props as T | undefined,\n    isTopDialog: overlayOrder.length > 0 && id === overlayOrder[overlayOrder.length - 1],\n  }\n}\n","import { createContext, type PropsWithChildren, type ReactNode, useCallback, useMemo, useReducer } from 'react'\nimport { createPortal } from 'react-dom'\nimport { useEvent } from 'react-use'\n\ntype ModalProps = {\n  show: () => void\n  close: () => void\n  isOpen: boolean\n  props: Record<string, unknown>\n}\n\ntype DialogContextProps = {\n  modals: Record<string, ModalProps>\n  show: (modalId: string, props?: Record<string, unknown>) => void\n  close: (modalId: string) => void\n  overlayOrder: string[]\n  updateProps: (modalId: string, props: Record<string, unknown>) => void\n}\n\nconst DIALOG_CONTEXT_INITIAL_STATE: DialogContextProps = {\n  modals: {},\n  show: () => {},\n  close: () => {},\n  overlayOrder: [],\n  updateProps: () => {},\n}\n\nexport const DialogContext = createContext(DIALOG_CONTEXT_INITIAL_STATE)\n\ntype DialogReducerActionType =\n  | { type: 'ShowModal'; payload: { modalId: string; props: Record<string, unknown> } }\n  | { type: 'CloseModal'; payload: { modalId: string } }\n  | { type: 'CloseTopModal'; payload?: undefined }\n  | { type: 'UpdatePropsModal'; payload: { modalId: string; props: Record<string, unknown> } }\n\nfunction DialogReducer(state: DialogContextProps, { type, payload }: DialogReducerActionType) {\n  switch (type) {\n    case 'ShowModal': {\n      const { modalId, props } = payload\n\n      return {\n        ...state,\n        overlayOrder: [...state.overlayOrder, modalId],\n        modals: {\n          ...state.modals,\n          [modalId]: {\n            ...state.modals[modalId],\n            isOpen: true,\n            props,\n          },\n        },\n      }\n    }\n    case 'CloseModal': {\n      const { modalId } = payload\n\n      return {\n        ...state,\n        overlayOrder: state.overlayOrder.filter((id) => id !== modalId),\n        modals: {\n          ...state.modals,\n          [modalId]: {\n            ...state.modals[modalId],\n            isOpen: false,\n          },\n        },\n      }\n    }\n    case 'CloseTopModal': {\n      if (state.overlayOrder.length === 0) {\n        return state\n      }\n\n      const modalId = state.overlayOrder[state.overlayOrder.length - 1]\n\n      return {\n        ...state,\n        overlayOrder: state.overlayOrder.slice(0, -1),\n        modals: {\n          ...state.modals,\n          [modalId]: {\n            ...state.modals[modalId],\n            isOpen: false,\n          },\n        },\n      }\n    }\n    case 'UpdatePropsModal': {\n      const { modalId, props } = payload\n\n      return {\n        ...state,\n        modals: {\n          ...state.modals,\n          [modalId]: {\n            ...state.modals[modalId],\n            props,\n          },\n        },\n      }\n    }\n  }\n}\n\nexport function DialogProvider({ children, dialogs }: PropsWithChildren<{ dialogs: ReactNode }>) {\n  const [state, dispatch] = useReducer(DialogReducer, DIALOG_CONTEXT_INITIAL_STATE)\n\n  useEvent('keydown', (event: KeyboardEvent) => {\n    if (event.key === 'Esc' || (event.key === 'Escape' && state.overlayOrder.length > 0)) {\n      dispatch({ type: 'CloseTopModal' })\n    }\n  })\n\n  const show = useCallback((modalId: string, props = {}) => {\n    dispatch({ type: 'ShowModal', payload: { modalId, props } })\n  }, [])\n\n  const close = useCallback((modalId: string) => {\n    dispatch({ type: 'CloseModal', payload: { modalId } })\n  }, [])\n\n  const updateProps = useCallback((modalId: string, props: Record<string, unknown>) => {\n    dispatch({ type: 'UpdatePropsModal', payload: { modalId, props } })\n  }, [])\n\n  const context = useMemo(\n    () => ({\n      ...state,\n      show,\n      close,\n      updateProps,\n    }),\n    [state, show, close, updateProps],\n  )\n\n  return (\n    <DialogContext.Provider value={context}>\n      {children}\n      <Portal>{dialogs}</Portal>\n    </DialogContext.Provider>\n  )\n}\n\nconst Portal = ({ children }: PropsWithChildren) => {\n  const portalRoot = document.body\n  return createPortal(children, portalRoot)\n}\n"],"mappings":"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","names":["index_exports","__export","Dialog","DialogContext","DialogProvider","useDialog","__toCommonJS","import_react","import_react_remove_scroll","import_react_use","import_react","import_react","import_react_dom","import_react_use","import_jsx_runtime","DIALOG_CONTEXT_INITIAL_STATE","DialogContext","DialogReducer","state","type","payload","modalId","props","id","DialogProvider","children","dialogs","dispatch","event","show","close","updateProps","context","Portal","portalRoot","useDialog","id","modals","overlayOrder","showModal","closeModal","updateProps","DialogContext","show","showProps","close","updatePropsDialog","newProps","import_jsx_runtime","DEFAULT_ANIMATION","Dialog","id","children","animation","onClickAwayCallback","contentRef","isOpen","close","isTopDialog","useDialog","animationProps","e","node"]}